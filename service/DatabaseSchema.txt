-- Tabla Admins
CREATE TABLE Admins (
    AdminId INTEGER PRIMARY KEY AUTOINCREMENT,
    Dni TEXT NOT NULL,
    Username TEXT,
    Surname TEXT,
    Email TEXT,
    Password BLOB,
    Role TEXT NOT NULL DEFAULT 'Admin',
    InscriptionDate TEXT NOT NULL DEFAULT (datetime('now','utc'))
);

-- Tabla Users
CREATE TABLE Users (
    UserId INTEGER PRIMARY KEY AUTOINCREMENT,
    Dni TEXT,
    Username TEXT,
    Surname TEXT,
    Email TEXT,
    FriendCode TEXT,
    Password BLOB,
    Role TEXT NOT NULL DEFAULT 'User',
    InscriptionDate TEXT NOT NULL DEFAULT (datetime('now','utc'))
);

-- Tabla Routines
CREATE TABLE Routines (
    RoutineId INTEGER PRIMARY KEY AUTOINCREMENT,
    RoutineName TEXT,
    RoutineDescription TEXT,
    UserId INTEGER NOT NULL,
    FOREIGN KEY (UserId) REFERENCES Users(UserId)
);

-- Tabla SplitDays (tabla de unión entre Routines y Exercises)
CREATE TABLE SplitDays (
    DayName TEXT,
    RoutineId INTEGER NOT NULL,
    PRIMARY KEY (DayName, RoutineId),
    FOREIGN KEY (RoutineId) REFERENCES Routines(RoutineId)
);

-- Tabla Exercises
CREATE TABLE Exercises (
    ExerciseId INTEGER PRIMARY KEY AUTOINCREMENT,
    ExerciseName TEXT,
    Sets INTEGER,
    Reps INTEGER,
    Weight REAL,
    RoutineId INTEGER NOT NULL,
    DayName TEXT NOT NULL,
    FOREIGN KEY (RoutineId, DayName) REFERENCES SplitDays(RoutineId, DayName)
);

-- Índices para mejorar el rendimiento
CREATE INDEX idx_users_email ON Users(Email);
CREATE INDEX idx_routines_user ON Routines(UserId);
CREATE INDEX idx_exercises_routine_day ON Exercises(RoutineId, DayName);